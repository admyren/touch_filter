/*
 * stm32_i2s.c
 *
 *  Created on: 11 sep. 2021
 *      Author: Myren
 */

#include "stm32f405xx.h"
#include "stm32_i2s.h"


void i2s_config(void)
{
   /* I2S2ext, SPI2 */

   /* Enable SPI2 peripheral clock */
   RCC->APB1ENR |= (1 << 14);

   /* Configure GPIO used by I2S */
   /*
   MCLK - PC6
   LRCLK (WS) - PB12
   BCLK (CK) - PB13
   ADCDAT (EXT_SD) - PB14
   DACDAT (SD) - PB15
   */

   /* Enable GPIOB peripheral clock */
   RCC->AHB1ENR |= (1 << 1);
   /* Enable GPIOC peripheral clock */
   RCC->AHB1ENR |= (1 << 1);
   /* Alternate function */
   GPIOB->MODER |= (2 << 14) | (2 << 12);
   GPIOC->MODER |= (2 << 14) | (2 << 12);
   /* AF4 alternate function */
   GPIOB->AFR[0] |= (4 << 28) | (4 << 24);
   GPIOC->AFR[0] |= (4 << 28) | (4 << 24);

}

