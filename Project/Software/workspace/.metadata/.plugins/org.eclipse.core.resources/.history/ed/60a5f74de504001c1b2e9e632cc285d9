/*
 * stm32_uart.h
 *
 *  Created on: 28 mars 2021
 *      Author: Myren
 */

#ifndef STM32_UART_H_
#define STM32_UART_H_

#include "stm32f4xx.h"
#include "stm32f405xx.h"
#include "stm32f4xx_hal.h"
#include <stdint.h>
#include <stdlib.h>



typedef enum
{
   SIZE_BYTE = 0,
   SIZE_HALF_WORD = 1,
   SIZE_WORD = 2
}DMA_DataSize;

typedef struct
{
   uint32_t channel;          // DMA channel
   DMA_DataSize periphDataSize;  // Peripheral data size
   DMA_DataSize memDataSize;     // Memory data size
   uint32_t direction;           // Direction, memory->peripheral(1) or peripheral->memory(0)
   uint32_t bufferSize;       // Number of element in the DMA buffer
   uint32_t periphAddr;       // Address to peripheral data register
   uint32_t memAddr;          // Address to first element of DMA buffer
   uint32_t halfIntEnable;       // DMA half transfer complete interrupt enable
   uint32_t compIntEnable;       // DMA transfer complete interrupt enable
   uint32_t mode;             // Circular mode or not
}DMA_InitVals;


void UART_Init(USART_TypeDef* huart, uint32_t baud, uint8_t* pDst, uint8_t size);
void UART_Transmit(USART_TypeDef* huart, uint8_t* data, uint8_t size);

//void initUART(uint32_t BAUD);
//void UART_puts(uint8_t* data, uint16_t size);


#if 0
#include <stdint.h>

#include "common.h"

#define UART_1_ADDR 0x40011000
#define UART_2_ADDR 0x40004400
#define UART_3_ADDR 0x40004800
#define UART_4_ADDR 0x40004C00
#define UART_5_ADDR 0x40005000
#define UART_6_ADDR 0x40011400

typedef struct
{
   volatile uint32_t SR;
   volatile uint32_t DR;
   volatile uint32_t BRR;
   volatile uint32_t CR1;
   volatile uint32_t CR2;
   volatile uint32_t CR3;
   volatile uint32_t GTPR;
}uart_reg_t;

#define UART1 ((uart_reg_t*)UART_1_ADDR)
#define UART2 ((uart_reg_t*)UART_2_ADDR)
#define UART3 ((uart_reg_t*)UART_3_ADDR)
#define UART4 ((uart_reg_t*)UART_4_ADDR)
#define UART5 ((uart_reg_t*)UART_5_ADDR)
#define UART6 ((uart_reg_t*)UART_6_ADDR)

typedef enum
{
   STOP_BITS_1 = 0,
   STOP_BITS_2,
}uart_stop_bit_e;

typedef enum
{
   DATA_BITS_8 = 0,
   DATA_BITS_9
}uart_data_bits_e;

typedef enum
{
   PARITY_EVEN = 0,
   PARITY_ODD
}uart_parity_e;

typedef enum
{
   BAUD_9600 = 9600,
   BAUD_19200 = 19200,
   BAUD_38400 = 38400,
   BAUD_57600 = 57600,
   BAUD_115200 = 115200
}uart_baud_rates_e;

typedef struct
{
   uart_baud_rates_e baud_rate;
   uart_stop_bit_e stop_bits;
   uart_data_bits_e data_bits;
   enable_disable_e parity_enable;
   uart_parity_e parity;
   enable_disable_e RX_enable;
   enable_disable_e TX_enable;
}uart_config_t;

uint32_t UART_config(uart_reg_t* uart_dev, uart_config_t* uart_conf);
void UART_tx(uart_reg_t* uart_dev, uint8_t* data, uint32_t size);
#endif



#endif /* STM32_UART_H_ */
